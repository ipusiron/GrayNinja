<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self'; connect-src 'none'; object-src 'none'; base-uri 'self'; form-action 'none';">
  <title>GrayNinja</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<header class="site-header">
  <h1>GrayNinja</h1>
  <p class="subtitle">グレイコード（Gray Code）のエンコーダー・ディスク可視化ツール</p>
  <button id="themeToggle" class="theme-toggle" aria-label="テーマ切り替え">
    <span class="theme-icon"></span>
  </button>
</header>

<nav class="tabs" role="tablist" aria-label="Tabs">
  <button class="tab active" data-tab="basics" role="tab" aria-selected="true">基本</button>
  <button class="tab" data-tab="disc" role="tab" aria-selected="false">ディスク</button>
  <button class="tab" data-tab="convert" role="tab" aria-selected="false">変換</button>
  <button class="tab" data-tab="usecases" role="tab" aria-selected="false">座学</button>
</nav>

<main>
  <!-- Basics -->
  <section id="panel-basics" class="panel active" role="tabpanel">
    <div class="panel-single">
      <section class="viz">
        <div class="accordion">
          <div class="accordion-item">
            <div class="accordion-header" data-target="gray-intro-content">
              <h2>グレイコードとは</h2>
              <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content" id="gray-intro-content">
              <div class="intro-list">
                <div class="intro-card">
                  <h3>1ビットずつ変化</h3>
                  <p>連続する値で必ず1ビットのみが変化する特殊な符号化方式</p>
                  <div class="example">
                    <span class="label">2進法:</span> 0111 → 1000 (4ビット変化)<br>
                    <span class="label">グレイ:</span> 0100 → 1100 (1ビット変化)
                  </div>
                </div>
                <div class="intro-card">
                  <h3>高い対称性</h3>
                  <p>コード列が左右対称の美しい数学的構造を持つ</p>
                  <div class="example">
                    <span class="label">n=2:</span> 00, 01, 11, 10<br>
                    <span class="label">n=3:</span> 000, 001, 011, 010, 110, 111, 101, 100<br>
                    <span class="accent">中心線で対称</span>
                  </div>
                </div>
                <div class="intro-card">
                  <h3>実用性</h3>
                  <p>センサー読み取り誤差の防止、通信エラー最小化に活用</p>
                  <div class="example">
                    <span class="label">応用:</span> エンコーダー、QAM通信<br>
                    <span class="accent">ノイズ耐性向上</span><br>
                    <span class="accent">→ 詳細は「座学」タブを参照</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <div class="accordion-header" data-target="hamming-info-content">
              <h2>ハミング距離とは</h2>
              <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content" id="hamming-info-content">
              <p class="hamming-desc">
                <strong>ハミング距離</strong>は、2つの同じ長さの文字列で<strong>異なる位置の個数</strong>を表します。
              </p>
              <div class="hamming-example">
                <div class="example-item">
                  <span class="label">例:</span> 1010 と 1100 のハミング距離<br>
                  <div class="hamming-visual">
                    <div class="binary-comparison">
                      <div class="binary-row">
                        <span class="bit">1</span>
                        <span class="bit">0</span>
                        <span class="bit">1</span>
                        <span class="bit">0</span>
                      </div>
                      <div class="binary-row">
                        <span class="bit">1</span>
                        <span class="bit">1</span>
                        <span class="bit">0</span>
                        <span class="bit">0</span>
                      </div>
                      <div class="diff-row">
                        <span class="diff-marker"></span>
                        <span class="diff-marker active">↑</span>
                        <span class="diff-marker active">↑</span>
                        <span class="diff-marker"></span>
                      </div>
                    </div>
                    <div class="result-line">→ ハミング距離 = 2 (位置2と位置3が異なる)</div>
                  </div>
                </div>
                <div class="example-item">
                  <span class="label">グレイコード:</span> 隣接する値のハミング距離は<strong>常に1</strong><br>
                  <div class="hamming-visual">
                    <code class="binary-line">0 1 0 0 → 1 1 0 0</code>
                    <div class="result-line">→ 位置1のみ変化（ハミング距離 = 1）</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="comparison-controls">
          <h3>比較表の操作</h3>

          <div class="control-row">
            <label>ビット数 n</label>
            <input id="bits" type="number" min="1" max="12" value="4" />
          </div>

          <div class="control-row">
            <label>速度</label>
            <span id="speedValue">600ms</span>
            <input id="speedSlider" type="range" min="100" max="2000" value="600" step="100">
          </div>

          <div class="control-row">
            <label>現在値 i （0〜2ⁿ−1）</label>
            <input id="valNum" type="number" min="0" max="15" value="0" />
            <input id="val" type="range" min="0" max="15" value="0" />
          </div>

          <div class="control-row">
            <button id="prev">◀︎ Prev</button>
            <button id="next">Next ▶︎</button>
            <label class="inline"><input id="auto" type="checkbox" /> 自動再生</label>
            <label class="inline"><input id="wrap" type="checkbox" checked /> 循環</label>
          </div>

          <p class="muted s">※n変更で範囲が更新されます</p>
        </div>

        <div class="current-values">
          <h3>バイナリコードとグレイコードの比較表</h3>
          <div class="cards">
            <div class="card">
              <div class="k">Decimal</div>
              <div class="v" id="decOut">0</div>
            </div>
            <div class="card">
              <div class="k">Binary</div>
              <code class="v" id="binOut">0000</code>
            </div>
            <div class="card">
              <div class="k">Gray</div>
              <code class="v" id="grayOut">0000</code>
            </div>
            <div class="card">
              <div class="k">
                隣接ハミング距離
                <span class="tooltip-trigger">?
                  <div class="tooltip">
                    <strong>Gray</strong>: グレイコード同士の距離（常に1）<br>
                    <strong>Bin</strong>: バイナリコード同士の距離（1〜数ビット）
                  </div>
                </span>
              </div>
              <div class="v" id="hdOut">Gray=1 / Bin=1</div>
            </div>
          </div>
        </div>

        <div class="tableWrap">
          <table id="seqTbl" class="mono">
            <thead>
              <tr><th>#</th><th>Binary</th><th>Gray</th><th>ΔHamming</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>
  </section>


  <!-- Encoder Disc -->
  <section id="panel-disc" class="panel" role="tabpanel">
    <div class="panel-grid">
      <aside class="controls">
        <h2>エンコーダー・ディスク操作</h2>

        <!-- 基本設定 -->
        <div class="control-group">
          <h3>基本設定</h3>
          <div class="control-row">
            <label>ビット数 n</label>
            <input id="discBits" type="number" min="1" max="12" value="4" />
          </div>
        </div>

        <!-- 自動回転 -->
        <div class="control-group">
          <h3>自動回転</h3>
          <div class="control-row">
            <button id="discRotateStart" class="spin-btn">▶ 再生</button>
            <button id="discRotateStop" class="spin-btn" disabled>⏸ 停止</button>
          </div>
          <div class="control-row">
            <label>回転速度</label>
            <span id="discRotateSpeedValue">50</span>
            <input id="discRotateSpeed" type="range" min="10" max="100" value="50" />
          </div>
        </div>

        <!-- 表示オプション -->
        <div class="control-group">
          <h3>表示オプション</h3>
          <div class="control-row">
            <label class="inline"><input id="showNumbers" type="checkbox" /> 数字01表示</label>
            <label class="inline"><input id="highlightSector" type="checkbox" checked /> セクターハイライト</label>
          </div>
        </div>

        <!-- 現在の状態 -->
        <div class="control-group">
          <h3>現在の状態</h3>
          <div class="cards">
            <div class="card">
              <div class="k">セクター</div>
              <div class="v"><span id="sectorOut">0</span> / <span id="sectorsTotal">16</span></div>
            </div>
            <div class="card">
              <div class="k">パターン（Gray）</div>
              <code class="v" id="discGray">0000</code>
            </div>
            <div class="card" id="binaryPatternCard" style="display:none;">
              <div class="k">パターン（Binary）</div>
              <code class="v" id="discBinaryPattern">0000</code>
            </div>
          </div>
        </div>

        <!-- セクター操作 -->
        <div class="control-group">
          <h3>セクター操作</h3>
          <div class="row gap">
            <button id="prevSector">◀︎ Prev</button>
            <button id="nextSector">Next ▶︎</button>
          </div>
          <div class="control-row">
            <button id="spinStart" class="spin-btn">▶ 回転</button>
            <button id="spinStop" class="spin-btn" disabled>⏸ 停止</button>
          </div>
          <div class="control-row">
            <label>回転速度</label>
            <span id="spinSpeedValue">50</span>
            <input id="spinSpeed" type="range" min="10" max="100" value="50" />
          </div>
        </div>
      </aside>

      <section class="viz">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:16px;">
          <div>
            <h3 style="margin:0 0 12px;font-size:16px;color:var(--accent);text-align:center;">グレイコードディスク</h3>
            <canvas id="disc" width="400" height="400" aria-label="Gray code disc"></canvas>
          </div>
          <div>
            <h3 style="margin:0 0 12px;font-size:16px;color:var(--accent);text-align:center;">バイナリディスク</h3>
            <canvas id="discBinary" width="400" height="400" aria-label="Binary disc"></canvas>
          </div>
        </div>
        <p class="muted s">リングは内側ほど下位ビット。白/黒＝0/1。手動回転で読み取りの安定性を体感。</p>
      </section>
    </div>
  </section>

  <!-- Convert -->
  <section id="panel-convert" class="panel" role="tabpanel">
    <div class="twocol">
      <div class="convBox">
        <h2>Binary → Gray</h2>
        <label>Binary 入力（0/1のみ）
          <input id="binIn" type="text" value="1010" />
        </label>
        <button id="toGray">変換</button>
        <div class="out"><code id="grayOut2">1111</code></div>
        <div class="formula">
          <span class="formula-label">変換式:</span>
          <code class="formula-code">g = b ⊕ (b ≫ 1)</code>
          <span class="tooltip-trigger">?
            <div class="tooltip">
              <strong>記号の意味</strong><br>
              <strong>⊕</strong>: XOR（排他的論理和）<br>
              <strong>≫</strong>: 右シフト演算<br>
              <strong>g</strong>: グレイコードのビット<br>
              <strong>b</strong>: バイナリコードのビット<br>
              <strong>1</strong>: 1ビット分シフト
            </div>
          </span>
        </div>

        <div class="calculation-process">
          <div class="accordion-item">
            <div class="accordion-header" data-target="binary-to-gray-process">
              <span>計算過程を表示</span>
              <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content" id="binary-to-gray-process">
              <div id="binaryToGraySteps" class="process-steps">
                <!-- 計算過程がここに動的に生成される -->
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="convBox">
        <h2>Gray → Binary</h2>
        <label>Gray 入力（0/1のみ）
          <input id="grayIn" type="text" value="1111" />
        </label>
        <button id="toBin">変換</button>
        <div class="out"><code id="binOut2">1010</code></div>
        <div class="formula">
          <span class="formula-label">変換式:</span>
          <code class="formula-code">bₙ = gₙ, bᵢ = bᵢ₊₁ ⊕ gᵢ</code>
          <span class="tooltip-trigger">?
            <div class="tooltip">
              <strong>記号の意味</strong><br>
              <strong>⊕</strong>: XOR（排他的論理和）<br>
              <strong>bₙ</strong>: バイナリの最上位ビット<br>
              <strong>gₙ</strong>: グレイの最上位ビット<br>
              <strong>bᵢ</strong>: バイナリのi番目のビット<br>
              <strong>gᵢ</strong>: グレイのi番目のビット<br>
              <strong>i</strong>: ビット位置（n-1から0まで）
            </div>
          </span>
        </div>

        <div class="calculation-process">
          <div class="accordion-item">
            <div class="accordion-header" data-target="gray-to-binary-process">
              <span>計算過程を表示</span>
              <span class="accordion-icon">▼</span>
            </div>
            <div class="accordion-content" id="gray-to-binary-process">
              <div id="grayToBinarySteps" class="process-steps">
                <!-- 計算過程がここに動的に生成される -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>



  <!-- Use cases -->
  <section id="panel-usecases" class="panel" role="tabpanel">
    <h2>グレイコードの応用</h2>
    <div class="cards usecases">
      <div class="ucard">
        <h3>絶対エンコーダー</h3>
        <p><strong>1ビット変化特性を活用</strong><br>
        セクター境界での読み取り誤差を防止。ロボット、工作機械、自動車のステアリング角度検出などに使用。</p>
      </div>
      <div class="ucard">
        <h3>デジタル通信</h3>
        <p><strong>エラー最小化を活用</strong><br>
        QAM、PSK変調で隣接シンボル間のハミング距離を1に保ち、ノイズによる誤り時のビット誤り数を最小化。</p>
      </div>
      <div class="ucard">
        <h3>論理回路設計</h3>
        <p><strong>対称性を活用</strong><br>
        カルノー図でのGray順配置により、隣接セルのグループ化が容易。状態遷移の最適化と回路簡略化を実現。</p>
      </div>
      <div class="ucard">
        <h3>A/D・D/A変換器</h3>
        <p><strong>単調性を活用</strong><br>
        アナログ-デジタル変換時の量子化誤差を最小化。音響機器、計測器での高精度変換に使用。</p>
      </div>
      <div class="ucard">
        <h3>メモリアドレッシング</h3>
        <p><strong>順次アクセス効率を活用</strong><br>
        フラッシュメモリやEEPROMでの書き込み/消去サイクル最適化。隣接アドレスでの電力消費削減。</p>
      </div>
      <div class="ucard">
        <h3>組合せ最適化</h3>
        <p><strong>探索効率を活用</strong><br>
        遺伝的アルゴリズム、焼きなまし法での近傍探索。1ビット変化による局所探索の効率化。</p>
      </div>
      <div class="ucard">
        <h3>暗号・セキュリティ</h3>
        <p><strong>サイドチャネル攻撃対策を活用</strong><br>
        スマートカードや暗号チップでの電力消費パターン隠蔽。ハミング重み変化の最小化により、電力解析攻撃への耐性を向上。</p>
      </div>
      <div class="ucard">
        <h3>FPGA・VLSI設計</h3>
        <p><strong>グリッチ最小化を活用</strong><br>
        ステートマシンの状態遷移で中間状態でのグリッチを防止。クロック境界での信号安定性確保とタイミング違反回避。</p>
      </div>
      <div class="ucard">
        <h3>光通信・レーダー</h3>
        <p><strong>位相連続性を活用</strong><br>
        FMCW（周波数変調連続波）レーダーや光ファイバー通信での位相変調。急激な位相変化を避けた信号品質向上とノイズ低減。</p>
      </div>
    </div>
  </section>
</main>

<footer>
  <div class="footer">
    🔗 GitHubリポジトリ（ <a href="https://github.com/ipusiron/GrayNinja" target="_blank">ipusiron/GrayNinja</a> ）
  </div>
</footer>

<script src="script.js"></script>
</body>
</html>
